<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fuel Calculator Test Suite - Five Forks Fire Weather</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #1a1a1a;
      color: #e0e0e0;
    }
    h1 { color: #4ECDC4; }
    h2 { color: #FFA726; border-bottom: 2px solid #FFA726; padding-bottom: 10px; }
    .test-section {
      background: #2a2a2a;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid #3a3a3a;
    }
    .pass { color: #4CAF50; font-weight: bold; }
    .fail { color: #F44336; font-weight: bold; }
    .warning { color: #FFA726; font-weight: bold; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #3a3a3a;
    }
    th {
      background: #333;
      color: #4ECDC4;
      font-weight: 600;
    }
    tr:hover { background: #2d2d2d; }
    .result-box {
      background: #1e1e1e;
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
      border-left: 4px solid #4ECDC4;
    }
    .critical { border-left-color: #EF5350; }
    .scenario {
      background: #252525;
      padding: 12px;
      border-radius: 6px;
      margin: 8px 0;
    }
    code {
      background: #1a1a1a;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
    }
  </style>
</head>
<body>
  <h1>üî• Fuel Moisture Calculator - Test & Validation Suite</h1>
  <p><strong>Author:</strong> James D. Cochran | <strong>Project:</strong> Five Forks Fire Weather</p>
  <p>Testing EMC calculations, time-lag drying models, and multi-day forecasts against real Virginia fire weather scenarios.</p>

  <div class="test-section">
    <h2>Test 1: EMC Calculation Validation</h2>
    <p>Verifying Equilibrium Moisture Content calculations match NFDRS standards.</p>
    <div id="test-emc"></div>
  </div>

  <div class="test-section">
    <h2>Test 2: Time-Lag Drying Model</h2>
    <p>Testing exponential decay toward EMC for 1-hour and 10-hour fuels.</p>
    <div id="test-timelag"></div>
  </div>

  <div class="test-section">
    <h2>Test 3: Virginia Drying Scenario</h2>
    <p>Real-world test: Current wet conditions (41¬∞F, 93% RH) drying over 5 days.</p>
    <div id="test-scenario"></div>
  </div>

  <div class="test-section">
    <h2>Test 4: Critical Fire Weather</h2>
    <p>Testing detection of critical drying conditions.</p>
    <div id="test-critical"></div>
  </div>

  <div class="test-section">
    <h2>Console Output</h2>
    <div id="console-output" class="result-box"></div>
  </div>

  <script src="fuel-calculator.js"></script>
  <script>
    // Console capture for display
    const consoleOutput = [];
    const originalLog = console.log;
    console.log = function(...args) {
      consoleOutput.push(args.join(' '));
      originalLog.apply(console, args);
    };

    function displayOutput() {
      document.getElementById('console-output').innerHTML = 
        '<pre>' + consoleOutput.join('\n') + '</pre>';
    }

    // Test 1: EMC Validation
    function testEMC() {
      const tests = [
        { temp: 85, rh: 25, expected: { min: 4, max: 6 }, name: "Hot & Dry (Critical)" },
        { temp: 70, rh: 40, expected: { min: 6, max: 8 }, name: "Moderate Conditions" },
        { temp: 50, rh: 60, expected: { min: 10, max: 13 }, name: "Cool & Humid" },
        { temp: 41, rh: 93, expected: { min: 18, max: 22 }, name: "Virginia Current (Wet)" }
      ];

      let html = '<table><tr><th>Scenario</th><th>Temp</th><th>RH</th><th>EMC</th><th>Expected Range</th><th>Status</th></tr>';
      
      tests.forEach(test => {
        const emc = computeEMC(test.temp, test.rh);
        const inRange = emc >= test.expected.min && emc <= test.expected.max;
        const status = inRange ? '<span class="pass">‚úì PASS</span>' : '<span class="fail">‚úó FAIL</span>';
        
        html += `<tr>
          <td>${test.name}</td>
          <td>${test.temp}¬∞F</td>
          <td>${test.rh}%</td>
          <td><strong>${emc.toFixed(1)}%</strong></td>
          <td>${test.expected.min}-${test.expected.max}%</td>
          <td>${status}</td>
        </tr>`;
        
        console.log(`EMC Test: ${test.name} - ${emc.toFixed(1)}% (${inRange ? 'PASS' : 'FAIL'})`);
      });
      
      html += '</table>';
      document.getElementById('test-emc').innerHTML = html;
    }

    // Test 2: Time-Lag Drying
    function testTimeLag() {
      const initial = 20; // 20% fuel moisture
      const emc = 5; // EMC at 5%
      const hours = 6; // 6 hours of drying
      
      const fuel1hr = stepMoisture(initial, emc, hours, 1);
      const fuel10hr = stepMoisture(initial, emc, hours, 10);
      
      const html = `
        <div class="result-box">
          <p><strong>Initial Moisture:</strong> ${initial}%</p>
          <p><strong>Target EMC:</strong> ${emc}%</p>
          <p><strong>Drying Time:</strong> ${hours} hours</p>
          <hr style="border-color: #3a3a3a;">
          <p><strong>1-Hour Fuel:</strong> ${fuel1hr.toFixed(1)}% 
            <span class="pass">(Fast drying, responds quickly)</span></p>
          <p><strong>10-Hour Fuel:</strong> ${fuel10hr.toFixed(1)}% 
            <span class="warning">(Slower drying, lags behind)</span></p>
          <p><em>‚úì Correct behavior: 1-hr fuels dry faster than 10-hr fuels</em></p>
        </div>
      `;
      
      document.getElementById('test-timelag').innerHTML = html;
      console.log(`Time-Lag Test: 1-hr=${fuel1hr.toFixed(1)}%, 10-hr=${fuel10hr.toFixed(1)}%`);
    }

    // Test 3: Virginia Scenario
    function testVirginiaScenario() {
      const config = {
        initial1Hr: 15,
        initial10Hr: 18,
        forecast: [
          { label: "Day 1 (Today)", temp: 41, rh: 93, wind: 3 },
          { label: "Day 2", temp: 55, rh: 65, wind: 5 },
          { label: "Day 3", temp: 68, rh: 45, wind: 8 },
          { label: "Day 4", temp: 75, rh: 30, wind: 12 },
          { label: "Day 5", temp: 80, rh: 22, wind: 15 }
        ]
      };
      
      const results = runFuelMoistureModel(config);
      
      let html = '<table><tr><th>Day</th><th>Temp</th><th>RH</th><th>Wind</th><th>EMC</th><th>1-Hr %</th><th>10-Hr %</th><th>Status</th></tr>';
      
      results.dailyResults.forEach(day => {
        const critical = day.is1HrCritical || day.is10HrCritical;
        const statusText = critical ? 'üî• CRITICAL' : '‚úì Safe';
        const rowClass = critical ? 'critical' : '';
        
        html += `<tr class="${rowClass}">
          <td><strong>${day.label}</strong></td>
          <td>${day.temp}¬∞F</td>
          <td>${day.rh}%</td>
          <td>${day.wind}mph</td>
          <td>${day.emc}%</td>
          <td>${day.moisture1Hr}%</td>
          <td>${day.moisture10Hr}%</td>
          <td>${statusText}</td>
        </tr>`;
      });
      
      html += '</table>';
      html += `<div class="result-box ${results.summary.firstCritical1HrDay ? 'critical' : ''}">
        <p><strong>Final 1-Hr Moisture:</strong> ${results.summary.final1Hr}%</p>
        <p><strong>Final 10-Hr Moisture:</strong> ${results.summary.final10Hr}%</p>
        <p><strong>First Critical Day (1-hr ‚â§ 6%):</strong> ${results.summary.firstCritical1HrDay || 'Not reached'}</p>
        <p><strong>First Critical Day (10-hr ‚â§ 8%):</strong> ${results.summary.firstCritical10HrDay || 'Not reached'}</p>
      </div>`;
      
      document.getElementById('test-scenario').innerHTML = html;
      console.log('Virginia Scenario Test:', results.summary);
    }

    // Test 4: Critical Conditions
    function testCritical() {
      const config = {
        initial1Hr: 12,
        initial10Hr: 15,
        forecast: [
          { label: "Day 1", temp: 85, rh: 20, wind: 18 },
          { label: "Day 2", temp: 90, rh: 15, wind: 20 },
          { label: "Day 3", temp: 88, rh: 18, wind: 22 }
        ]
      };
      
      const results = runFuelMoistureModel(config);
      
      const html = `
        <div class="result-box critical">
          <h3>üî• Extreme Fire Weather Test</h3>
          <p>This scenario represents dangerous fire conditions with hot temperatures, low humidity, and strong winds.</p>
          <hr style="border-color: #3a3a3a;">
          <p><strong>Day 1:</strong> 1-Hr = ${results.dailyResults[0].moisture1Hr}% | 10-Hr = ${results.dailyResults[0].moisture10Hr}%</p>
          <p><strong>Day 2:</strong> 1-Hr = ${results.dailyResults[1].moisture1Hr}% | 10-Hr = ${results.dailyResults[1].moisture10Hr}%</p>
          <p><strong>Day 3:</strong> 1-Hr = ${results.dailyResults[2].moisture1Hr}% | 10-Hr = ${results.dailyResults[2].moisture10Hr}%</p>
          <hr style="border-color: #3a3a3a;">
          <p class="fail"><strong>‚ö†Ô∏è ALERT:</strong> Critical drying detected on ${results.summary.firstCritical1HrDay || 'N/A'}</p>
          <p><em>This scenario should trigger operational fire weather warnings.</em></p>
        </div>
      `;
      
      document.getElementById('test-critical').innerHTML = html;
      console.log('Critical Test:', results.summary);
    }

    // Run all tests
    console.log('=== Fuel Calculator Test Suite ===');
    console.log('Author: James D. Cochran');
    console.log('Running validation tests...\n');
    
    testEMC();
    testTimeLag();
    testVirginiaScenario();
    testCritical();
    
    console.log('\n=== Tests Complete ===');
    displayOutput();
  </script>
</body>
</html>
